(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[179],{63:(e,s,r)=>{"use strict";var t=r(7260);r.o(t,"useRouter")&&r.d(s,{useRouter:function(){return t.useRouter}}),r.o(t,"useSearchParams")&&r.d(s,{useSearchParams:function(){return t.useSearchParams}})},5540:(e,s,r)=>{Promise.resolve().then(r.bind(r,6554))},6554:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>i});var t=r(5155),a=r(2115),l=r(63);function i(){let e=(0,l.useRouter)(),[s,r]=(0,a.useState)(null),[i,n]=(0,a.useState)(!0),[d,o]=(0,a.useState)(!1),[c,m]=(0,a.useState)("product"),[u,x]=(0,a.useState)(null),[b,h]=(0,a.useState)(null),[p,g]=(0,a.useState)(!1),[j,y]=(0,a.useState)(null),[f,v]=(0,a.useState)(!1);(0,a.useEffect)(()=>{N()},[]);let N=async()=>{try{n(!0);let e=await fetch("/api/admin/email-templates");if(!e.ok)throw Error("Failed to fetch templates");let s=await e.json();r(s)}catch(e){console.error("Error fetching templates:",e),x("Failed to load email templates")}finally{n(!1)}},w=async e=>{if(s)try{o(!0),x(null),h(null);let r=await fetch("/api/admin/email-templates",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({templateType:e,templates:s[e]})});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to save templates")}h("".concat("product"===e?"Product":"Repair"," templates saved successfully!")),setTimeout(()=>h(null),3e3)}catch(e){console.error("Error saving templates:",e),x(e instanceof Error?e.message:"Failed to save templates")}finally{o(!1)}},S=(e,t,a)=>{s&&r(s=>{if(!s)return null;let r={...s},l=t.split("."),i=r[e];for(let e=0;e<l.length-1;e++)i[l[e]]||(i[l[e]]={}),i=i[l[e]];return i[l[l.length-1]]=a,r})},C=async(e,r)=>{if(s){v(!0);try{let s={id:"sample-order-id",orderNumber:"JB-1234567890-ABCD",customerName:"John Doe",customerEmail:"john.doe@example.com",customerAddress:"product"===e?"123 Main St, Anytown, USA 12345":void 0,total:299.99,createdAt:new Date().toISOString(),items:[{product:{id:"repair"===e?"mail-in-service":"sample-product",name:"repair"===e?"Mail-in Repair Service":"Sample Product"},quantity:1,price:299.99}],repairQuote:"QUOTE_SENT"===r?"Sample repair quote:\n\nParts needed: $150\nLabor: $100\nTotal: $250":null},t=await fetch("/api/admin/email-templates/preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({templateType:e,status:"initial"===r?"initial":r,orderData:s})});if(!t.ok)throw Error("Failed to generate preview");let a=await t.json();y(a),g(!0)}catch(e){console.error("Error generating preview:",e),x("Failed to generate email preview")}finally{v(!1)}}};return i?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading email templates..."})]})}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsxs)("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:[(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Email Templates"}),(0,t.jsx)("p",{className:"mt-2 text-gray-600",children:"Manage email templates for product orders and repair services"})]}),(0,t.jsx)("button",{onClick:()=>e.push("/admin/dashboard"),className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Back to Dashboard"})]})}),u&&(0,t.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md",children:u}),b&&(0,t.jsx)("div",{className:"mb-6 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-md",children:b}),(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsx)("div",{className:"border-b border-gray-200",children:(0,t.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,t.jsx)("button",{onClick:()=>m("product"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("product"===c?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Product Orders"}),(0,t.jsx)("button",{onClick:()=>m("repair"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("repair"===c?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Repair Services"})]})})}),(e=>{if(!s)return null;let r=s[e];return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Initial Confirmation Email"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject"}),(0,t.jsx)("input",{type:"text",value:r.initialConfirmation.subject,onChange:s=>S(e,"initialConfirmation.subject",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Content"}),(0,t.jsx)("textarea",{value:r.initialConfirmation.content,onChange:s=>S(e,"initialConfirmation.content",s.target.value),rows:10,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900",placeholder:"Enter email content. Use [customerName], [orderNumber], etc. for variables."}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)("button",{onClick:()=>C(e,"initial"),disabled:f,className:"text-sm bg-gray-100 text-gray-700 px-3 py-1 rounded hover:bg-gray-200 disabled:opacity-50",children:f?"Generating...":"Preview Email"})})]})]})]}),(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Status Update Emails"}),(0,t.jsx)("div",{className:"space-y-4",children:Object.entries(r.statusUpdates).map(s=>{let[r,a]=s;return(0,t.jsxs)("div",{className:"border border-gray-200 p-4 rounded-md",children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:r.replace(/_/g," ").toLowerCase().replace(/\b\w/g,e=>e.toUpperCase())}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject"}),(0,t.jsx)("input",{type:"text",value:a.subject,onChange:s=>S(e,"statusUpdates.".concat(r,".subject"),s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),(0,t.jsx)("textarea",{value:a.message,onChange:s=>S(e,"statusUpdates.".concat(r,".message"),s.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)("button",{onClick:()=>C(e,r),disabled:f,className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded hover:bg-gray-200 disabled:opacity-50",children:f?"Generating...":"Preview"})})]}),"QUOTE_SENT"===r&&(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message with Quote"}),(0,t.jsx)("textarea",{value:a.messageWithQuote||"",onChange:s=>S(e,"statusUpdates.".concat(r,".messageWithQuote"),s.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900",placeholder:"Message when repair quote is available"})]})})]})]},r)})})]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{onClick:()=>w(e),disabled:d,className:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Saving...":"Save ".concat("product"===e?"Product":"Repair"," Templates")})})]})})(c),(0,t.jsxs)("div",{className:"mt-8 bg-blue-50 border border-blue-200 p-6 rounded-md",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"Available Variables"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-blue-800 mb-2",children:"General Variables:"}),(0,t.jsxs)("ul",{className:"space-y-1 text-blue-700",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"[customerName]"})," - Customer's name"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"[orderNumber]"})," - Order number"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"[orderDate]"})," - Formatted order date"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"[total]"})," - Order total"]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-blue-800 mb-2",children:"Product Orders:"}),(0,t.jsxs)("ul",{className:"space-y-1 text-blue-700",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"[customerAddress]"})," - Shipping address"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"[itemsList]"})," - Formatted items list"]})]}),(0,t.jsx)("h4",{className:"font-medium text-blue-800 mb-2 mt-3",children:"Repair Services:"}),(0,t.jsxs)("ul",{className:"space-y-1 text-blue-700",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"[itemsList]"})," - Formatted items list"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"[repairQuote]"})," - Repair quote details"]})]})]})]})]})]}),p&&j&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Email Preview"}),(0,t.jsx)("button",{onClick:()=>g(!1),className:"text-gray-500 hover:text-gray-700",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-80px)]",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Subject:"}),(0,t.jsx)("p",{className:"text-gray-700",children:j.subject})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Content:"}),(0,t.jsx)("div",{className:"border border-gray-200 p-4 bg-gray-50 rounded",dangerouslySetInnerHTML:{__html:j.html}})]})]})]})})]})}}},e=>{e.O(0,[441,255,120],()=>e(e.s=5540)),_N_E=e.O()}]);